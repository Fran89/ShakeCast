<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="/css/main.css">

		<script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script src="js/shakemap.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/mapapp_capture.js"></script>
		<script type="text/javascript" src="/js/sc_constant.js"></script>
		<script type="text/javascript" src="js/storage.js"></script>
<script type="text/javascript">
var evid;
var type
//var mmi = ["I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X+"];
//var zoom = [8, 8, 8, 7, 7, 7, 6, 6, 6, 6, 6, 5, 5, 5, 5];
var facMarkers = [];
//var bar = {'GREY':'bar-grey', 'GREEN':'bar-success', 'YELLOW':'bar-yellow', 'ORANGE':'bar-warning', 'RED':'bar-danger'};

function initialize() {
	sc_id = evid ? evid : gup('event');
	type = gup('type');

	var local_url = '/scripts/damage.pl/from_id/' + sc_id;
	if (type) {
		local_url += '?type='+type;
	}
	SC_DEF.init();
alert(localStorage.length-2);
	$.getJSON(local_url, function(data) {

	  // Are there even any EQ to display?
	  if (typeof data.grid.shakemap_id === "undefined") {
		return;
	  }

		var lat_min = parseFloat(data.grid.lat_min);
		var lat_max = parseFloat(data.grid.lat_max);
		var lon_min = parseFloat(data.grid.lon_min);
		var lon_max = parseFloat(data.grid.lon_max);

		var rectBounds = new google.maps.LatLngBounds(
					new google.maps.LatLng(lat_min, lon_min),
					new google.maps.LatLng(lat_max, lon_max));
		var img = '/data/'+ sc_id +'/ii_overlay.png';
		var latlng = new google.maps.LatLng((lat_min+lat_max)/2, (lon_min+lon_max)/2);

		MAPAPP.init(latlng, SC_DEF.DEFAULT_ZOOM);
		//console.log(zoom[parseInt(lon_max-lon_min+0.5)]+' '+parseInt(lon_max-lon_min+0.5));

		MAPAPP.loadSM(rectBounds, img);

		var event = data.grid;
		event.facility_type = "epicenter";
		MAPAPP.addMarker(event);
		
			
		  for ( var key in data.facility_damage)
			{
			MAPAPP.addMarker(data.facility_damage[key]);

			};

	});

	var dmg_url = '/scripts/damage.pl/from_id/'+sc_id+'?action=summary';
	$.getJSON(dmg_url, function(summary) {
		var damage_summary = '<div class="progress">';
		// Are there even any EQ to display?
		if (summary.count > 0) {
			jQuery.each(summary.damage_summary, function(i, val) {
				damage_summary += '<div class="bar ' + bar[i] + '" style="width: ' + val/summary.count*100 + '%;">' + val + '</div>';
			});
		}
		damage_summary += '</div>';
		$("#caption").html(damage_summary);
	});
   // update the map display

		$('html').width($("map_pane").width());
		$('html').height($("map_pane").height());
} // initializek
</script>
</head>
<body onload="initialize()">
<div id="map_pane" style="width:1024px; height:512px">
<div id="map_canvas" style="width:1024px; height:512px"></div>
<div id="caption"></div>
</div>
</body></html>
